<div class="container">
  <form [formGroup]="form" ngNativeValidate (submit)="onSubmit()">
    <div class="row text-center">
      <div class="col">
        <h3>DEMAND FOR (MACHINE) BLOCK</h3>
      </div>
    </div>
    <div class="row align-items-center">
      <div class="col-auto me-auto">
        <div class="form-group mt-3 mb-3">
          <label>Department</label>
          <select class="form-select" formControlName="department">
            <option value="CONSTRUCTION">CONSTRUCTION</option>
            <option value="ENGINEERING">ENGINEERING</option>
            <option value="S&T">S&T</option>
            <option value="ELECTRIC">ELECTRIC</option>
            <option value="RE">RE</option>
            <option value="RVNL">RVNL</option>
            <option value="SIGNAL">SIGNAL</option>
            <option value="Telecom">Telecom</option>
            <option value="TRD">TRD</option>
          </select>
        </div>
      </div>

      <div class="col-auto">
        <button class="btn btn-primary btn-lg me-2" (click)="onAddNewForm()">
          Add
        </button>
        <button class="btn btn-success btn-lg me-2" type="submit">
          Submit
        </button>
      </div>
    </div>

    <div
      class="accordion"
      id="accordionPanelsStayOpenExample"
      formArrayName="machineFormArray"
    >
      <ng-container
        *ngFor="let item of machineFormArray.controls; let i = index"
      >
        <div class="accordion-item mb-2">
          <h2 class="accordion-header d-flex">
            <button
              class="accordion-button"
              type="button"
              data-bs-toggle="collapse"
              [attr.data-bs-target]="'#collapse' + i"
              aria-expanded="true"
              [attr.aria-controls]="'collapse' + i"
            >
              {{ department.value }}-{{ i + 1 }}
            </button>
            <button class="btn btn-outline-danger ms-2" (click)="onDelete(i)">
              Delete
            </button>
          </h2>
          <div [id]="'collapse' + i" class="accordion-collapse collapse show">
            <div class="accordion-body">
              <div [formGroupName]="i">
                <div class="row">
                  <div class="col-sm-6 col-md-3">
                    <div class="form-group mt-3 mb-3">
                      <label>Board</label>
                      <select
                        class="form-select"
                        formControlName="board"
                        required
                      >
                        <option value="" selected disabled>Select Board</option>
                        <option value="BD1">BD1</option>
                        <option value="BD2">BD2</option>
                        <option value="BD3">BD3</option>
                        <option value="BD4">BD4</option>
                        <option value="BD5">BD5</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-sm-6 col-md-3">
                    <div class="form-group mt-3 mb-3">
                      <label>Section</label>
                      <select
                        class="form-select"
                        formControlName="section"
                        required
                      >
                        <option value="" selected disabled>
                          Select Section
                        </option>
                        @for(section of sectionList; track $index){
                        <option value="{{ section }}">{{ section }}</option>
                        }
                      </select>
                    </div>
                  </div>
                  <div class="col-sm-6 col-md-3">
                    <div class="form-group mt-3 mb-3">
                      <label>Station From</label>
                      <select
                        class="form-select"
                        formControlName="stationFrom"
                        required
                      >
                        <option value="" selected disabled>
                          Select Station
                        </option>
                        @for(station of stations; track $index){
                        <option value="{{ station }}">{{ station }}</option>
                        }
                      </select>
                    </div>
                  </div>
                  <div class="col-sm-6 col-md-3">
                    <div class="form-group mt-3 mb-3">
                      <label>Station To</label>
                      <select
                        class="form-select"
                        formControlName="stationTo"
                        required
                      >
                        <option value="" selected disabled>
                          Select Station
                        </option>
                        @for(station of stations; track $index){
                        <option value="{{ station }}">{{ station }}</option>
                        }
                      </select>
                    </div>
                  </div>
                  <div class="col-sm-6 col-md-3">
                    <div class="form-group mt-3 mb-3">
                      <label>Direction</label>
                      <select
                        class="form-select"
                        formControlName="direction"
                        required
                      >
                        <option value="" selected disabled>
                          Select Direction
                        </option>
                        <option value="BOTH">BOTH</option>
                        <option value="UP">UP</option>
                        <option value="DN">DN</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-sm-6 col-md-3">
                    <div class="form-group mt-3 mb-3">
                      <label>Series</label>
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Enter Series"
                        formControlName="series"
                        required
                      />
                    </div>
                  </div>
                  <div class="col-sm-6 col-md-3">
                    <div class="form-group mt-3 mb-3">
                      <label>Whether NI work/PNI work or Non-NI Work</label>
                      <select class="form-select" formControlName="ni" required>
                        <option value="" selected disabled>
                          Select NI/Non-NI Work
                        </option>
                        <option value="Yes">Yes</option>
                        <option value="No">no</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-sm-6 col-md-3">
                    <div class="form-group mt-3 mb-3">
                      <label>Yard</label>
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Enter Yard"
                        formControlName="yard"
                        required
                      />
                    </div>
                  </div>
                  <div class="col-sm-6 col-md-3">
                    <div class="form-group mt-3 mb-3">
                      <label>Type of Work</label>
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Enter Type of Work"
                        formControlName="typeOfWork"
                        required
                      />
                    </div>
                  </div>
                  <div class="col-sm-6 col-md-3">
                    <div class="form-group mt-3 mb-3">
                      <label>Available Slot</label>
                      <select
                        class="form-select"
                        formControlName="availableSlot"
                        required
                      >
                        <option value="" selected disabled>
                          Select Available Slot
                        </option>
                        @for(date of availableSlots[
                        machineFormArray.controls[i].get("section").value+'_'+
                        machineFormArray.controls[i].get("direction").value];
                        track $index){
                        <option value="{{ date }}">{{ date }}</option>
                        }
                      </select>
                    </div>
                  </div>
                  <div class="col-sm-6 col-md-3">
                    <div class="form-group mt-3 mb-3">
                      <label>Quantum</label>
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Enter Quantum"
                        formControlName="quantum"
                        required
                      />
                    </div>
                  </div>
                  <div class="col-sm-6 col-md-3">
                    <div class="form-group mt-3 mb-3">
                      <label>Deputed Supervisor</label>
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Enter Deputed Supervisor"
                        formControlName="deputedSupervisior"
                        required
                      />
                    </div>
                  </div>
                  <div class="col-sm-6 col-md-3">
                    <div class="form-group mt-3 mb-3">
                      <label>Resources</label>
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Enter Resources"
                        formControlName="resources"
                        required
                      />
                    </div>
                  </div>
                  <div class="col-sm-6 col-md-3">
                    <div class="form-group mt-3 mb-3">
                      <label>APPROVAL</label>
                      <select
                        class="form-select"
                        formControlName="approval"
                        required
                      >
                        <option value="" disabled selected>
                          Select APPROVAL
                        </option>
                        <option value="Yes">Yes</option>
                        <option value="No">No</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-sm-6 col-md-3">
                    <div class="form-group mt-3 mb-3">
                      <label>Time Duration (In Minutes)</label>
                      <input
                        type="number"
                        class="form-control"
                        placeholder="Enter Time Duration"
                        formControlName="time"
                        required
                      />
                    </div>
                  </div>
                  @if(department.value ==="ELECTRIC"){
                  <div class="col-sm-6 col-md-3">
                    <div class="form-group mt-3 mb-3">
                      <label>TOWER WAGON/MATERIAL TRAIN</label>
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Enter TOWER WAGON/MATERIAL TRAIN"
                        formControlName="tower"
                        required
                      />
                    </div>
                  </div>
                  } @if(department.value ==="ENGINEERING"){
                  <div class="col-sm-6 col-md-3">
                    <div class="form-group mt-3 mb-3">
                      <label>Machine</label>
                      <select
                        class="form-select"
                        formControlName="machine"
                        required
                      >
                        <option value="" selected disabled>
                          Select Machine
                        </option>
                        <option value="BCM">BCM</option>
                        <option value="BRM">BRM</option>
                        <option value="CSM">CSM</option>
                        <option value="DGS">DGS</option>
                        <option value="DTE">DTE</option>
                        <option value="DUO">DUO</option>
                        <option value="DUOMATIC">DUOMATIC</option>
                        <option value="LADDER">LADDER</option>
                        <option value="MPT">MPT</option>
                        <option value="PBR">PBR</option>
                        <option value="PQRS">PQRS</option>
                        <option value="SBCM">SBCM</option>
                        <option value="T">T</option>
                        <option value="TOWER WAGON">TOWER WAGON</option>
                        <option value="UNIMAT">UNIMAT</option>
                        <option value="UTV">UTV</option>
                        <option value="WIRING TRAIN">WIRING TRAIN</option>
                        <option value="MAST ERECTION TRAIN">
                          MAST ERECTION TRAIN
                        </option>
                        <option value="Others">Others</option>
                      </select>
                    </div>
                  </div>
                  } @if(department.value ==="ENGINEERING"||department.value
                  ==="S&T"){
                  <div class="col-sm-6 col-md-3">
                    <div class="form-group mt-3 mb-3">
                      <label>TPC STAFF </label>
                      <select
                        class="form-select"
                        formControlName="tpcStaff"
                        required
                      >
                        <option value="" disabled selected>
                          Select TPC STAFF
                        </option>
                        <option value="Yes">Yes</option>
                        <option value="No">No</option>
                      </select>
                    </div>
                  </div>
                  } @if(department.value ==="ENGINEERING"||department.value
                  ==="ELECTRIC"){
                  <div class="col-sm-6 col-md-3">
                    <div class="form-group mt-3 mb-3">
                      <label>Line No.</label>
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Enter Line Number"
                        formControlName="lineNo"
                        required
                      />
                    </div>
                  </div>

                  <div class="col-sm-6 col-md-3">
                    <div class="form-group mt-3 mb-3">
                      <label>REMARKS IF ANY</label>
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Enter REMARKS IF ANY"
                        formControlName="remarks"
                        required
                      />
                    </div>
                  </div>
                  <div class="col-sm-6 col-md-3">
                    <div class="form-group mt-3 mb-3">
                      <label>S&T STAFF</label>
                      <select
                        class="form-select"
                        formControlName="s_tStaff"
                        required
                      >
                        <option value="" selected disabled>
                          Select S&T STAFF
                        </option>
                        <option value="Yes">Yes</option>
                        <option value="No">No</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-sm-6 col-md-3">
                    <div class="form-group mt-3 mb-3">
                      <input type="checkbox" formControlName="crewCheckbox" />
                      <label>Crew Required</label>
                      @if(machineFormArray.controls[i].get('crewCheckbox').value){
                      <input
                        type="number"
                        class="form-control"
                        placeholder="Enter Number of Crew Required"
                        formControlName="crew"
                        required
                      />
                      }
                    </div>
                  </div>
                  <div class="col-sm-6 col-md-3">
                    <div class="form-group mt-3 mb-3">
                      <input type="checkbox" formControlName="locoCheckbox" />
                      <label>Loco Required</label>
                      @if(machineFormArray.controls[i].get('locoCheckbox').value){
                      <input
                        type="number"
                        class="form-control"
                        placeholder="Enter Number of Loco Required"
                        formControlName="loco"
                        required
                      />
                      }
                    </div>
                  </div>
                  } @if(department.value ==="S&T"){
                  <div class="col-sm-6 col-md-3">
                    <div class="form-group mt-3 mb-3">
                      <label>POINT/BPAC/OTHERS</label>
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Enter POINT/BPAC/OTHERS"
                        formControlName="point"
                        required
                      />
                    </div>
                  </div>
                  }
                </div>
              </div>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
  </form>
</div>

<!-- <div class="col-sm-6 col-md-3">
  <div class="form-group mt-3 mb-3">
    <label>DISCONNECTION DEMAND HOURS</label>
    <input
      type="text"
      class="form-control"
      placeholder="Enter DISCONNECTION DEMAND HOURS"
      formControlName="lineNo"
    />
  </div>
</div> -->
